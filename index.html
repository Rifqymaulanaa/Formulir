<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Formulir Preferensi Komunikasi</title>
  <style>
    :root{
      --primary:#4361ee;--secondary:#3a0ca3;--accent:#f72585;
      --light:#f8f9fa;--dark:#212529;--success:#4cc9f0;
      --warning:#f9c74f;--danger:#f94144;--visual:#7209b7;
      --audio:#3a86ff;--kinesthetic:#06d6a0;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
    body{background:#f0f2f5;color:var(--dark);line-height:1.6}
    .container{max-width:1000px;margin:0 auto;padding:20px}
    header{text-align:center;margin-bottom:30px;padding:20px;background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
    h1{font-size:28px;margin-bottom:10px}
    .progress-container{margin:24px 0;background:#e9ecef;border-radius:10px;height:12px;overflow:hidden}
    .progress-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--primary),var(--accent));transition:width .4s ease}
    .form-section{background:#fff;border-radius:12px;padding:24px;margin-bottom:22px;box-shadow:0 4px 12px rgba(0,0,0,.06);display:none}
    .form-section.active{display:block;animation:fadeIn .35s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
    .form-group{margin-bottom:18px}
    label{display:block;margin-bottom:8px;font-weight:600}
    input[type="text"],select{width:100%;padding:12px 14px;border:1px solid #ced4da;border-radius:8px;font-size:16px;transition:border-color .25s}
    input[type="text"]:focus,select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(67,97,238,.18)}
    .options-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px;margin-top:12px}
    .option-card{border:2px solid #e9ecef;border-radius:12px;padding:18px;cursor:pointer;transition:all .22s ease;text-align:center;user-select:none}
    .option-card:hover{transform:translateY(-3px);box-shadow:0 8px 14px rgba(0,0,0,.08)}
    .option-card.selected{border-color:var(--primary);background:rgba(67,97,238,.06)}
    .visual-option:hover,.visual-option.selected{border-color:var(--visual)}
    .audio-option:hover,.audio-option.selected{border-color:var(--audio)}
    .kinesthetic-option:hover,.kinesthetic-option.selected{border-color:var(--kinesthetic)}
    .option-icon{font-size:34px;margin-bottom:8px}
    .option-title{font-weight:700;margin-bottom:6px}
    .option-description{color:#6c757d;font-size:14px}
    .btn-container{display:flex;justify-content:space-between;gap:10px;margin-top:22px}
    button{padding:12px 20px;border:none;border-radius:10px;font-size:16px;font-weight:700;cursor:pointer;transition:all .2s}
    .btn-prev{background:#e9ecef;color:var(--dark)}
    .btn-prev:hover{background:#dee2e6}
    .btn-next{background:var(--primary);color:#fff}
    .btn-next:hover{background:var(--secondary)}
    .btn-next[disabled]{opacity:.5;cursor:not-allowed}
    .btn-submit{background:var(--success);color:#fff}
    .btn-submit:hover{filter:brightness(0.95)}
    .results-container{background:#fff;border-radius:12px;padding:26px;margin-top:24px;box-shadow:0 4px 12px rgba(0,0,0,.08);display:none}
    .result-card{text-align:center;padding:18px;border-radius:12px;margin-bottom:14px}
    .result-score{font-size:40px;font-weight:800;margin:10px 0}
    .chart-container{height:320px;margin:22px 0}
    .visual-result{background:rgba(114,9,183,.08);color:var(--visual)}
    .audio-result{background:rgba(58,134,255,.08);color:var(--audio)}
    .kinesthetic-result{background:rgba(6,214,160,.08);color:var(--kinesthetic)}
    .dominant-style{border:3px solid currentColor;transform:scale(1.02)}
    .dominant-result{background:#f8f9fa;border:1px dashed #ced4da;border-radius:12px;padding:14px}
    footer{text-align:center;margin-top:34px;padding:16px;color:#6c757d;font-size:14px}
    @media(max-width:768px){
      .options-container{grid-template-columns:1fr}
      .btn-container{flex-direction:column}
      .btn-container button{width:100%}
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1>Formulir Preferensi Komunikasi</h1>
    <p>Isi formulir berikut untuk mengetahui gaya komunikasi Anda</p>
  </header>

  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <form id="preferenceForm" novalidate>
    <!-- Section 1: Data Diri -->
    <div class="form-section active" id="section1" data-kind="profile">
      <h2>Data Diri</h2>
      <div class="form-group">
        <label for="nama">Nama Lengkap</label>
        <input type="text" id="nama" name="nama" autocomplete="name" required/>
      </div>
      <div class="form-group">
        <label for="jabatan">Jabatan</label>
        <select id="jabatan" name="jabatan" required>
          <option value="">Pilih Jabatan</option>
          <option>ASM</option><option>Sekeman</option><option>SVP</option>
          <option>SPV</option><option>GM</option><option>SPV Fleet</option>
          <option>Lainnya</option>
        </select>
      </div>
      <div class="btn-container">
        <div></div>
        <button type="button" class="btn-next" id="toQ1">Selanjutnya</button>
      </div>
    </div>
  </form>

  <div class="results-container" id="resultsContainer" aria-live="polite">
    <h2>Hasil Preferensi Komunikasi</h2>
    <p>Berdasarkan jawaban Anda, berikut adalah hasilnya:</p>
    <div id="resultsContent"></div>
    <div class="btn-container" style="justify-content:flex-end">
      <button type="button" class="btn-next" id="resetBtn">Isi Kembali</button>
    </div>
  </div>
</div>

<footer>
  <p>Â© 2025 Total Solusindo - Sistem Assessment Preferensi Komunikasi</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
  /* ====== KONFIG ====== */
  const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxzjRwMhQhdpsLMVokkBdnJx6H-cD_T3I1v4SAiBKFx3UXdvVt4jeCFERsNhVrG0zo_ow/exec'; // <-- paste URL web app dari Apps Script

  /* ====== DATA PERTANYAAN ====== */
  const questions = [
    "Ketika mempelajari hal baru, saya lebih mudah memahami dengan:",
    "Saat memberikan presentasi, saya lebih suka:",
    "Jika terjadi miskomunikasi, saya biasanya:",
    "Saya paling nyaman belajar melalui:",
    "Dalam rapat, saya lebih fokus pada:",
    "Saat mengingat informasi, saya biasanya:",
    "Ketika merasa stres, saya cenderung:",
    "Saya paling mudah mengingat nama seseorang dengan:",
    "Dalam menyampaikan ide, saya lebih sering:"
  ];
  const optionMeta = {
    A: { label: "Visual", icon: "ðŸ‘ï¸", desc: "Gambar/diagram/demonstrasi visual", cls: "visual-option" },
    B: { label: "Auditori", icon: "ðŸ‘‚", desc: "Penjelasan lisan/diskusi", cls: "audio-option" },
    C: { label: "Kinestetik", icon: "âœ‹", desc: "Praktik langsung/pengalaman", cls: "kinesthetic-option" }
  };

  /* ====== STATE ====== */
  let currentSection = 1;
  const totalSections = 1 + questions.length + 1;
  const userAnswers = { nama:"", jabatan:"", answers:Array(questions.length).fill("") };

  const $ = (sel, root=document)=>root.querySelector(sel);
  const $$ = (sel, root=document)=>Array.from(root.querySelectorAll(sel));

  function setProgress(n){
    const step = Math.min(n-1, totalSections-1);
    $("#progressBar").style.width = (step/(totalSections-1))*100+"%";
  }
  function switchToSection(target){
    const active=$(".form-section.active"); if(active) active.classList.remove("active");
    const el=$("#section"+target); if(!el) return;
    el.classList.add("active"); currentSection=target; setProgress(target);
    if(el.dataset.kind==="question"){
      const qIdx=Number(el.dataset.qIndex);
      $(".btn-next",el).disabled=!userAnswers.answers[qIdx];
      const chosen=userAnswers.answers[qIdx];
      if(chosen){ $$(".option-card",el).forEach(c=>c.classList.toggle("selected", c.dataset.value===chosen)); }
    }
  }
  function ensureProfileValid(){
    const nama=$("#nama").value.trim(); const jabatan=$("#jabatan").value.trim();
    if(!nama||!jabatan){alert("Harap isi Nama dan Jabatan terlebih dahulu.");return false;}
    userAnswers.nama=nama; userAnswers.jabatan=jabatan; return true;
  }
  function onSelectOption(sectionEl,value){
    const qIdx=Number(sectionEl.dataset.qIndex);
    $$(".option-card",sectionEl).forEach(c=>c.classList.remove("selected"));
    const chosenEl=$(`.option-card[data-value="${value}"]`,sectionEl); if(chosenEl) chosenEl.classList.add("selected");
    userAnswers.answers[qIdx]=value; $(".btn-next",sectionEl).disabled=false;
  }
  function goPrev(){ if(currentSection>1) switchToSection(currentSection-1); }
  function goNext(){
    const here=$("#section"+currentSection); const kind=here?.dataset.kind;
    if(kind==="profile"){ if(!ensureProfileValid())return; return switchToSection(2); }
    if(kind==="question"){ const qIdx=Number(here.dataset.qIndex); if(!userAnswers.answers[qIdx]){alert("Pilih salah satu opsi dulu ya.");return;} return switchToSection(currentSection+1); }
    if(kind==="submit"){ return submitForm(); }
  }

  /* ====== SUBMIT ====== */
  async function sendToSheet(payload){
    // mode:'no-cors' supaya aman CORS saat kirim ke Apps Script Web App
    try{
      await fetch(WEB_APP_URL,{
        method:'POST',
        mode:'no-cors',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(payload)
      });
      // Tidak bisa membaca response saat no-cors â€” tapi datanya terkirim
    }catch(err){
      console.error(err);
      alert("Gagal mengirim ke Sheet. Cek URL Web App & izin aksesnya.");
    }
  }

  function submitForm(){
    if(userAnswers.answers.some(a=>!a)){
      const firstEmpty=userAnswers.answers.findIndex(a=>!a);
      alert("Masih ada pertanyaan yang kosong. Yuk diselesaikan ðŸ™");
      return switchToSection(2+firstEmpty);
    }
    const scores={A:0,B:0,C:0};
    userAnswers.answers.forEach(a=>{if(scores[a]!=null) scores[a]++;});
    const labels={A:"Visual",B:"Auditori",C:"Kinestetik"};
    let dominant="A"; if(scores.B>scores[dominant]) dominant="B"; if(scores.C>scores[dominant]) dominant="C";

    // Susun baris sesuai kolom Aâ€“L di Sheet
    const row = [
      userAnswers.nama,
      userAnswers.jabatan,
      ...userAnswers.answers,          // 9 jawaban (C, B, dst)
      labels[dominant]                 // Hasil Dominan
    ];

    // Kirim ke Sheet
    sendToSheet({sheetName:'Sheet1', row});

    // Tampilkan hasil di halaman
    displayResults(scores, labels[dominant]);
  }

  function displayResults(scores, dominantLabel){
    const desc={
      Visual:"Lebih mudah memahami melalui gambar/diagram/visualisasi.",
      Auditori:"Lebih mudah menyerap lewat suara, diskusi, dan penjelasan lisan.",
      Kinestetik:"Paling efektif lewat pengalaman langsung dan praktik."
    };
    $("#resultsContent").innerHTML=`
      <div class="chart-container"><canvas id="resultsChart" height="320"></canvas></div>
      <div class="result-card visual-result ${dominantLabel==='Visual'?'dominant-style':''}"><h3>Visual</h3><div class="result-score">${scores.A}</div></div>
      <div class="result-card audio-result ${dominantLabel==='Auditori'?'dominant-style':''}"><h3>Auditori</h3><div class="result-score">${scores.B}</div></div>
      <div class="result-card kinesthetic-result ${dominantLabel==='Kinestetik'?'dominant-style':''}"><h3>Kinestetik</h3><div class="result-score">${scores.C}</div></div>
      <div class="dominant-result"><h3>Gaya Dominan: ${dominantLabel}</h3><p>${desc[dominantLabel]}</p></div>`;
    $("#preferenceForm").style.display="none"; $("#resultsContainer").style.display="block";

    new Chart($("#resultsChart"),{
      type:"bar",
      data:{labels:["Visual (A)","Auditori (B)","Kinestetik (C)"],datasets:[{label:"Skor",data:[scores.A,scores.B,scores.C]}]},
      options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,ticks:{stepSize:1}}}}
    });
  }

  function resetForm(){
    $("#preferenceForm").reset();
    userAnswers.nama=""; userAnswers.jabatan="";
    userAnswers.answers=Array(questions.length).fill("");
    $("#resultsContainer").style.display="none"; $("#preferenceForm").style.display="block";
    $$(".option-card.selected").forEach(c=>c.classList.remove("selected"));
    switchToSection(1);
  }

  function shuffleArray(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
  function buildQuestionSection(qIndex){
    const sectionNumber=2+qIndex;
    const sec=document.createElement("div"); sec.className="form-section"; sec.id="section"+sectionNumber; sec.dataset.kind="question"; sec.dataset.qIndex=String(qIndex);
    const optionKeys=shuffleArray(["A","B","C"].slice());
    sec.innerHTML=`
      <h2>Pertanyaan ${qIndex+1}</h2><p>${questions[qIndex]}</p>
      <div class="options-container" role="radiogroup">
        ${optionKeys.map(v=>{const m=optionMeta[v];return `<div class="option-card ${m.cls}" data-value="${v}" tabindex="0" role="radio" aria-checked="false"><div class="option-icon">${m.icon}</div><div class="option-title">${m.label} (${v})</div><div class="option-description">${m.desc}</div></div>`;}).join("")}
      </div>
      <div class="btn-container"><button type="button" class="btn-prev">Sebelumnya</button><button type="button" class="btn-next" disabled>Selanjutnya</button></div>`;
    $(".btn-prev",sec).addEventListener("click",goPrev);
    $(".btn-next",sec).addEventListener("click",goNext);
    $$(".option-card",sec).forEach(card=>{
      card.addEventListener("click",()=>onSelectOption(sec,card.dataset.value));
      card.addEventListener("keydown",e=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();onSelectOption(sec,card.dataset.value);}});
    });
    return sec;
  }
  function buildSubmitSection(){
    const submitNumber=2+questions.length;
    const sec=document.createElement("div"); sec.className="form-section"; sec.id="section"+submitNumber; sec.dataset.kind="submit";
    sec.innerHTML=`<h2>Terima Kasih</h2><p>Semua pertanyaan sudah terjawab. Silakan submit.</p><div class="btn-container"><button type="button" class="btn-prev">Sebelumnya</button><button type="button" class="btn-submit">Submit Jawaban</button></div>`;
    $(".btn-prev",sec).addEventListener("click",goPrev);
    $(".btn-submit",sec).addEventListener("click",submitForm);
    return sec;
  }
  document.addEventListener("DOMContentLoaded",()=>{
    const form=$("#preferenceForm");
    questions.forEach((_,idx)=>{form.appendChild(buildQuestionSection(idx));});
    form.appendChild(buildSubmitSection());
    $("#toQ1").addEventListener("click",()=>goNext());
    $("#resetBtn").addEventListener("click",resetForm);
    setProgress(currentSection);
  });
</script>
</body>
</html>
